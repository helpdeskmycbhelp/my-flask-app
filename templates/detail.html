<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ (prop.building_name or 'Property') }}{% if prop.unit_number %} - Unit {{ prop.unit_number }}{% endif %} | Property Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap + Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    :root{ --cb-primary:#0056d2; --cb-dark:#0b2a66; --cb-bg:#f4f6fc; --glass: rgba(255,255,255,.8); }
    body{ background:var(--cb-bg); font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial }
    .hero{ position:relative; overflow:hidden; color:#fff;
      background:
        radial-gradient(1000px 500px at -10% 0%, rgba(255,255,255,.18) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(135deg,#0d47a1 0%,#1976d2 50%,#42a5f5 100%);
    }
    .hero .breadcrumb{ --bs-breadcrumb-divider: '›'; }
    .hero-wave{ position:absolute; left:0; right:0; bottom:-1px; height:60px;
      background:url("data:image/svg+xml,%3Csvg width='1440' height='70' viewBox='0 0 1440 70' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,35 C280,90 520,-10 760,20 C1000,50 1220,20 1440,35 L1440,70 L0,70 Z' fill='%23f4f6fc'/%3E%3C/svg%3E") center/cover no-repeat;
      filter:drop-shadow(0 -1px 0 rgba(255,255,255,.2));
    }
    .card{ border:1px solid rgba(0,86,210,.12); border-radius:16px; background:linear-gradient(180deg,var(--glass),#fff); box-shadow:0 12px 30px rgba(0,0,0,.06) }
    .card-header{ background:transparent; border-bottom:1px dashed rgba(0,86,210,.18); font-weight:700; color:var(--cb-dark) }
    .chip{ display:inline-flex; align-items:center; gap:.4rem; padding:.4rem .65rem; border-radius:999px; background:#eef4ff; color:#174ea6; border:1px solid rgba(0,86,210,.18); font-size:.86rem; margin:.15rem .25rem .15rem 0 }
    .chip .bi{ font-size:1rem }
    .info-grid{ row-gap:.5rem }
    .info-item{ display:flex; gap:.5rem; align-items:center; color:#324b72 }
    .info-item .icon{ width:36px; height:36px; display:grid; place-items:center; border-radius:10px; background:#eef4ff; border:1px solid rgba(0,86,210,.15); color:#174ea6 }
    .table thead th{ background:#f1f5ff; color:#173a7a; border-color:rgba(0,86,210,.15) }
    .table td, .table th{ vertical-align:middle }
    .contact-badge{ display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .6rem; background:#f8fafc; border:1px dashed rgba(0,86,210,.2); border-radius:999px; margin:.15rem .25rem .15rem 0 }
    .contact-actions .btn{ border-radius:999px }
    .sticky-actions{ position:sticky; bottom:0; z-index:100; background:rgba(244,246,252,.8); backdrop-filter:blur(8px); border-top:1px solid rgba(0,0,0,.06); padding:.75rem }
    @media (max-width:768px){ .hero h1{ font-size:1.4rem } }
  </style>
</head>
<body>

  <!-- HERO -->
  <section class="hero py-4 pb-5">
    <div class="container position-relative" style="z-index:2">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item"><a class="link-light text-decoration-none" href="{{ url_for('home') }}">Listings</a></li>
          <li class="breadcrumb-item active text-white-50" aria-current="page">Details</li>
        </ol>
      </nav>
      <h1 class="mb-2">
        {{ prop.building_name or 'Property' }}
        {% if prop.unit_number %} • Unit {{ prop.unit_number }}{% endif %}
      </h1>

      <div class="d-flex flex-wrap">
        {% if prop.city %}<span class="chip"><i class="bi bi-buildings"></i>{{ prop.city }}</span>{% endif %}
        {% if prop.community %}<span class="chip"><i class="bi bi-geo-alt"></i>{{ prop.community }}</span>{% endif %}
        {% if prop.sub_community %}<span class="chip"><i class="bi bi-geo"></i>{{ prop.sub_community }}</span>{% endif %}
        {% if prop.property_type %}<span class="chip"><i class="bi bi-houses"></i>{{ prop.property_type }}</span>{% endif %}
        {% if prop.sub_type %}<span class="chip"><i class="bi bi-tags"></i>{{ prop.sub_type }}</span>{% endif %}
        {% if prop.municipality_number %}<span class="chip"><i class="bi bi-hash"></i>Mun No {{ prop.municipality_number }}</span>{% endif %}
        {% if prop.municipality_sub_number %}<span class="chip"><i class="bi bi-hash"></i>Mun Sub No {{ prop.municipality_sub_number }}</span>{% endif %}
      </div>
    </div>
    <div class="hero-wave"></div>
  </section>

  <div class="container py-4">
    <div class="row g-4">
      <!-- LEFT: Details -->
      <div class="col-lg-7">

        <!-- Property Info -->
        <div class="card mb-4">
          <div class="card-header px-4 py-3">Property Information</div>
          <div class="card-body px-4">
            <div class="row info-grid">

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-aspect-ratio"></i></div>
                  <div>
                    <div class="text-muted small">Area</div>
                    <div class="fw-semibold">
                      {% if prop.area_sqft is number %} {{ "{:,.2f}".format(prop.area_sqft) }} sqft
                      {% else %} {{ prop.area_sqft or 'N/A' }} {% endif %}
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-door-open"></i></div>
                  <div>
                    <div class="text-muted small">Beds</div>
                    <div class="fw-semibold">{{ prop.beds or "N/A" }}</div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-currency-exchange"></i></div>
                  <div>
                    <div class="text-muted small">Price</div>
                    <div class="fw-bold text-success">
                      {% if prop.price is number %} AED {{ "{:,.0f}".format(prop.price) }}
                      {% else %} {{ prop.price or "N/A" }} {% endif %}
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-buildings"></i></div>
                  <div>
                    <div class="text-muted small">City</div>
                    <div class="fw-semibold">{{ prop.city or "N/A" }}</div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-pin-map"></i></div>
                  <div>
                    <div class="text-muted small">Community</div>
                    <div class="fw-semibold">{{ prop.community or "N/A" }}</div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-geo"></i></div>
                  <div>
                    <div class="text-muted small">Sub Community</div>
                    <div class="fw-semibold">{{ prop.sub_community or "N/A" }}</div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-hash"></i></div>
                  <div>
                    <div class="text-muted small">Municipality No</div>
                    <div class="fw-semibold">{{ prop.municipality_number or "N/A" }}</div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="info-item">
                  <div class="icon"><i class="bi bi-hash"></i></div>
                  <div>
                    <div class="text-muted small">Municipality Sub No</div>
                    <div class="fw-semibold">{{ prop.municipality_sub_number or "N/A" }}</div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Owners -->
        <div class="card mb-4">
          <div class="card-header px-4 py-3">Owner(s)</div>
          <div class="card-body px-3 pb-3">
            <div class="table-responsive">
              <table class="table align-middle mb-0">
                <thead>
                  <tr>
                    <th style="min-width:180px">Name</th>
                    <th style="min-width:100px">Role</th>
                    <th style="min-width:280px">Contact</th>
                    <th style="min-width:160px">Registration Date</th>
                  </tr>
                </thead>
                <tbody>
                  {% if prop.owners and prop.owners|length %}
                    {% for owner in prop.owners %}
                      {% set nums = owner.contacts if owner.contacts is defined else [] %}
                      <tr>
                        <td class="fw-semibold">{{ owner.owner_name }}</td>
                        <td>{{ owner.role or '—' }}</td>
                        <td>
                          {% if nums and nums|length %}
                            {% for n in nums %}
                              {% set clean = (n|string).replace('+','').replace(' ','').replace('-','') %}
                              <span class="contact-badge"><i class="bi bi-telephone"></i> {{ n }}</span>
                              <span class="contact-actions d-inline-flex gap-1 mb-1">
                                <a class="btn btn-sm btn-outline-primary" href="tel:{{ n }}"><i class="bi bi-telephone-forward"></i></a>
                                <a class="btn btn-sm btn-outline-success" target="_blank" href="https://wa.me/{{ clean }}"><i class="bi bi-whatsapp"></i></a>
                                <button class="btn btn-sm btn-outline-secondary" type="button" onclick="copyText('{{ clean }}')"><i class="bi bi-clipboard"></i></button>
                              </span><br>
                            {% endfor %}
                          {% else %} N/A {% endif %}
                        </td>
                        <td>{{ owner.registration_date or 'N/A' }}</td>
                      </tr>
                    {% endfor %}
                  {% elif prop.owner_name or prop.role or prop.reg_date or prop.contacts %}
                    {% set flat_nums = (prop.contacts if prop.contacts is iterable and (prop.contacts is not string) else [prop.contacts]) if prop.contacts else [] %}
                    <tr>
                      <td class="fw-semibold">{{ prop.owner_name or 'N/A' }}</td>
                      <td>{{ prop.role or '—' }}</td>
                      <td>
                        {% if flat_nums and flat_nums|length %}
                          {% for n in flat_nums %}
                            {% set clean = (n|string).replace('+','').replace(' ','').replace('-','') %}
                            <span class="contact-badge"><i class="bi bi-telephone"></i> {{ n }}</span>
                            <span class="contact-actions d-inline-flex gap-1 mb-1">
                              <a class="btn btn-sm btn-outline-primary" href="tel:{{ n }}"><i class="bi bi-telephone-forward"></i></a>
                              <a class="btn btn-sm btn-outline-success" target="_blank" href="https://wa.me/{{ clean }}"><i class="bi bi-whatsapp"></i></a>
                              <button class="btn btn-sm btn-outline-secondary" type="button" onclick="copyText('{{ clean }}')"><i class="bi bi-clipboard"></i></button>
                            </span><br>
                          {% endfor %}
                        {% else %} N/A {% endif %}
                      </td>
                      <td>
                        {% if prop.reg_date %}{{ prop.reg_date }}
                        {% elif prop.registration_date %}{{ prop.registration_date }}
                        {% else %}N/A{% endif %}
                      </td>
                    </tr>
                  {% else %}
                    <tr><td colspan="4" class="text-muted">No owner info available.</td></tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT: Summary / CTA -->
      <div class="col-lg-5">
        <div class="card mb-4">
          <div class="card-header px-4 py-3">Summary</div>
          <div class="card-body px-4">
            <div class="d-flex flex-column gap-2">
              <div><span class="text-muted small">Building</span><div class="fw-semibold">{{ prop.building_name }}</div></div>
              <div><span class="text-muted small">Unit</span><div class="fw-semibold">{{ prop.unit_number }}</div></div>
              <div><span class="text-muted small">Type</span><div class="fw-semibold">{{ prop.property_type or 'N/A' }}</div></div>
              <div><span class="text-muted small">Area</span>
                <div class="fw-semibold">
                  {% if prop.area_sqft is number %} {{ "{:,.2f}".format(prop.area_sqft) }} sqft
                  {% else %} {{ prop.area_sqft or 'N/A' }} {% endif %}
                </div>
              </div>
              <div><span class="text-muted small">Beds</span><div class="fw-semibold">{{ prop.beds or 'N/A' }}</div></div>
              <div class="mt-1">
                <span class="text-muted small">Price</span>
                <div class="fs-5 fw-bold text-success">
                  {% if prop.price is number %} AED {{ "{:,.0f}".format(prop.price) }}
                  {% else %} {{ prop.price or 'N/A' }} {% endif %}
                </div>
              </div>
            </div>

            <div class="d-grid gap-2 mt-3">
              <a href="javascript:window.print()" class="btn btn-outline-secondary"><i class="bi bi-printer"></i> Print</a>
              <a href="{{ url_for('home') }}" class="btn btn-primary"><i class="bi bi-arrow-left"></i> Back to Listings</a>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header px-4 py-3">Notes</div>
          <div class="card-body px-4">
            <p class="text-muted mb-0">Add internal notes or tags here in future iterations (e.g., “On Hold”, “Visited”, “Owner Verified”).</p>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Sticky actions (mobile) -->
  <div class="sticky-actions d-md-none">
    <div class="d-grid gap-2">
      <a href="{{ url_for('home') }}" class="btn btn-primary"><i class="bi bi-arrow-left"></i> Back to Listings</a>
    </div>
  </div>

  <script>
    function copyText(text){
      navigator.clipboard.writeText(text).then(()=> {
        const btn = event.currentTarget;
        const old = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check2"></i>';
        setTimeout(()=> btn.innerHTML = old, 1100);
      }).catch(()=>{});
    }
  </script>
</body>
</html>
