<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Coldwell Banker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Bootstrap & (optional) Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --cb-primary:#0056d2;
      --cb-dark:#003366;
      --cb-bg:#f4f6fc;
      --card-glass: rgba(255,255,255,.65);
      --card-stroke: rgba(0,86,210,.15);
    }
    body { background-color:var(--cb-bg); font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial }
    h1,h2,h3,h4,h5 { color:var(--cb-dark); font-weight:700 }

    /* ---------- HERO ---------- */
    .hero{position:relative;overflow:hidden;background:
      radial-gradient(1000px 600px at -10% -20%, rgba(255,255,255,.25) 0%, rgba(255,255,255,0) 60%),
      radial-gradient(800px 500px at 110% 10%, rgba(255,255,255,.18) 0%, rgba(255,255,255,0) 60%),
      linear-gradient(135deg, #0d47a1 0%, #1976d2 50%, #42a5f5 100%);color:#fff}
    .hero::after{content:"";position:absolute;left:0;right:0;bottom:-1px;height:80px;
      background:url("data:image/svg+xml,%3Csvg width='1440' height='80' viewBox='0 0 1440 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,40 C240,100 480,-20 720,20 C960,60 1200,20 1440,40 L1440,80 L0,80 Z' fill='%23f4f6fc'/%3E%3C/svg%3E") center/cover no-repeat;filter:drop-shadow(0 -1px 0 rgba(255,255,255,.2));z-index:1}
    .hero .badge{background:rgba(255,255,255,.15);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.25)}
    .shape{position:absolute;border-radius:50%;background:rgba(255,255,255,0.08);animation:float 10s infinite ease-in-out;z-index:0}
    .shape-1{width:120px;height:120px;top:8%;left:4%}
    .shape-2{width:90px;height:90px;bottom:18%;right:8%;animation-delay:-3s}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
    .hero-form-stats{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,.2);border-radius:1rem;padding:1.25rem;backdrop-filter:blur(8px);box-shadow:0 10px 24px rgba(0,0,0,.15)}
    .hero-input{border:none;padding:.9rem 1.1rem;border-radius:.85rem;box-shadow:0 8px 24px rgba(0,0,0,.18);flex:1 1 auto}
    .btn-cta{padding:.9rem 1.25rem;border-radius:.85rem;font-weight:700;box-shadow:0 10px 24px rgba(0,0,0,.18);white-space:nowrap}
    .hero-stats{gap:.75rem}
    .hero-stat{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);backdrop-filter:blur(6px);border-radius:16px;padding:.75rem 1rem;min-width:140px;text-align:center;color:#fff}
    .hero-stat .num{font-size:1.15rem;font-weight:800;line-height:1}

    /* ---------- SECTION BACKGROUND ---------- */
    .section-bg{
      position: relative;
      background:
        radial-gradient(1000px 500px at -10% 10%, rgba(0,86,210,.06) 0%, rgba(0,86,210,0) 60%),
        radial-gradient(900px 480px at 110% 30%, rgba(0,86,210,.05) 0%, rgba(0,86,210,0) 60%),
        var(--cb-bg);
      border-radius: 24px;
    }
    .section-bg::before{
      content:"";
      position:absolute; inset:0;
      background-image:
        url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%230056d21a'%3E%3Ccircle cx='10' cy='10' r='1.3'/%3E%3Ccircle cx='60' cy='60' r='1.1'/%3E%3Ccircle cx='110' cy='30' r='1.2'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 120px 120px;
      opacity:.7;
      pointer-events:none;
      border-radius:24px;
    }

    /* ---------- LISTING CARDS ---------- */
    .property-card{
      position:relative;
      border:1px solid var(--card-stroke);
      border-radius:18px;
      background:linear-gradient(180deg, var(--card-glass), #fff);
      box-shadow:0 10px 26px rgba(0,0,0,.07);
      transition:.25s ease;
      overflow:hidden;
    }
    .property-card::before{
      content:""; position:absolute; inset:0; padding:1px; border-radius:18px;
      background:linear-gradient(135deg, rgba(0,86,210,.35), rgba(0,86,210,0));
      -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
      -webkit-mask-composite:xor; mask-composite:exclude; pointer-events:none;
    }
    .property-card:hover{ transform:translateY(-6px); box-shadow:0 18px 44px rgba(0,0,0,.14) }

    .property-media{
      position:relative; border-radius:14px; overflow:hidden; background:#e9eef7;
      aspect-ratio: 16 / 9;
    }
    .property-media img{
      width:100%; height:100%; object-fit:cover; transition:transform .35s ease;
    }
    .property-card:hover .property-media img{ transform:scale(1.06) }
    .media-gradient{
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,0) 35%, rgba(0,0,0,.35));
    }

    .price-pill{
      position:absolute; left:12px; bottom:12px; z-index:2;
      background:#fff; color:#0b2a66; font-weight:800;
      padding:.4rem .6rem; border-radius:999px;
      box-shadow:0 8px 20px rgba(0,0,0,.15);
    }
    .quick-actions{
      position:absolute; right:10px; top:10px; display:flex; gap:.35rem; z-index:2;
    }
    .qa-btn{
      width:34px; height:34px; display:grid; place-items:center;
      background:rgba(255,255,255,.92); border:1px solid rgba(0,0,0,.06);
      border-radius:10px; cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.12);
    }
    .qa-btn:hover{ transform:translateY(-2px) }

    .pc-body{ padding:14px 6px 10px }
    .pc-header{ display:flex; align-items:center; gap:.5rem; margin-bottom:.25rem }
    .pc-dot{ width:8px; height:8px; border-radius:50%; background:linear-gradient(135deg,#1fa2ff,#12d8fa,#a6ffcb); box-shadow:0 0 0 3px rgba(0,86,210,.08) }
    .pc-title{ margin:0; font-weight:800; color:var(--cb-dark); line-height:1.25 }
    .pc-sub{ color:#6b7a90; font-size:.85rem }

    .pc-chips{ display:flex; flex-wrap:wrap; gap:.35rem; margin:.5rem 0 .35rem }
    .chip{
      font-size:.78rem; line-height:1; padding:.42rem .55rem; border-radius:999px;
      background:#eef4ff; color:#174ea6; border:1px solid rgba(0,86,210,.18);
    }
    .chip.muted{ background:#f4f6fa; color:#5b6b81; border-color:rgba(0,0,0,.06) }

    .pc-meta{ display:flex; flex-wrap:wrap; gap:.9rem; margin:.2rem 0 .6rem }
    .meta{ font-size:.88rem; color:#1f2d3d }
    .meta b{ color:#0b2a66 }

    .pc-footer{
      display:flex; justify-content:space-between; align-items:center; gap:.5rem;
      border-top:1px dashed rgba(0,86,210,.15); padding-top:.6rem; margin-top:.2rem;
    }
    .btn-outline-primary{ border-radius:10px }

    /* Image skeleton + fade-in */
    .pc-img{
      opacity: 0;
      transition: opacity .35s ease;
      background: linear-gradient(90deg, #eef2f9, #f6f8fc, #eef2f9);
      background-size: 400% 100%;
      animation: shimmer 1.2s infinite linear;
    }
    .pc-img.loaded{
      opacity: 1;
      animation: none;
      background: none;
    }
    @keyframes shimmer{
      0%{ background-position: 0% 0; }
      100%{ background-position: 100% 0; }
    }

    /* Pagination & filters */
    .accordion-button:not(.collapsed){ background:var(--cb-primary); color:#fff }
    .pagination .page-item.active .page-link{ background:var(--cb-primary); border-color:var(--cb-primary) }
    .pagination .page-link{ color:var(--cb-primary) }

    /* Responsive tweaks */
    @media (max-width:768px){
      .filter-desktop{ display:none!important }
      .hero-title{ font-size:1.7rem }
      .hero-sub{ font-size:1rem }
      .hero-form-stats{ padding:1rem }
      .hero-stats{ justify-content:center }
    }
    @media (min-width:769px){
      .filter-mobile{ display:none!important }
      .hero-title{ font-size:2.4rem }
      .hero-sub{ font-size:1.125rem }
    }

    /* --- Wave & stacking --- */
.hero{
  position: relative;
  z-index: 2;             /* above the next section */
  padding-bottom: 4.5rem; /* space for wave */
}
.hero::after{
  content:"";
  position:absolute; left:0; right:0;
  height:110px; bottom:-40px;       /* push wave down a bit */
  z-index: 3; pointer-events:none;
  background:url("data:image/svg+xml,%3Csvg width='1440' height='80' viewBox='0 0 1440 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,40 C240,100 480,-20 720,20 C960,60 1200,20 1440,40 L1440,80 L0,80 Z' fill='%23f4f6fc'/%3E%3C/svg%3E")
           center/cover no-repeat;
  filter: drop-shadow(0 -1px 0 rgba(255,255,255,.2));
}
.section-bg{
  position: relative;
  z-index: 1;           /* below hero wave */
  margin-top: -8px;     /* tuck up under the wave */
}

/* --- Let menus overflow on mobile & desktop filter areas --- */
.section-bg,
.filter-desktop, .filter-desktop .row, .filter-desktop .form-floating,
.filter-mobile, .filter-mobile .accordion, .filter-mobile .accordion-item,
.filter-mobile .accordion-body, .filter-mobile .card, .filter-mobile .card-body {
  overflow: visible !important;
}

/* Filters should sit above the wave */
.filter-desktop .row,
.filter-mobile .card {
  position: relative;
  z-index: 3000;
}

/* --- Choices.js layers --- */
.choices { z-index: 3100 !important; }
.choices__list--dropdown,
.choices__list[aria-expanded]{
  position: absolute;
  z-index: 3200 !important;
  width: 100%;
  max-height: 260px;
  overflow: auto;
  box-shadow: 0 10px 24px rgba(0,0,0,.12);
}

/* Keep the search input pinned at the top of the dropdown */
.choices__list--dropdown .choices__input{
  position: sticky;
  top: 0;
  background:#fff;
  z-index: 1;
  border-bottom: 1px solid #ddd;
}
/* Let each form row allow the menu to spill out */
.filter-desktop,
.filter-desktop .row,
.filter-mobile,
.filter-mobile .accordion-body,
.form-floating {
  position: relative;
  overflow: visible !important;
}

/* Labels shouldn’t sit above the menu */
.form-floating > label{
  z-index: 1;              /* keep label behind the menu */
  pointer-events: none;    /* clicks go to the input/menu */
}

/* Base stacking for Choices input wrapper */
.form-floating .choices{
  position: relative;
  z-index: 10;
}

/* When a Choices is opened, lift it above neighboring fields */
.form-floating .choices.is-open{
  z-index: 5000;           /* higher than other .form-floating blocks */
}

/* The dropdown itself must sit on top of everything nearby */
.form-floating .choices__list--dropdown,
.form-floating .choices__list[aria-expanded]{
  position: absolute;
  z-index: 6000;           /* higher than the wrapper */
  width: 100%;
  max-height: 260px;
  overflow: auto;
  box-shadow: 0 10px 24px rgba(0,0,0,.12);
  background: #fff;        /* ensure it’s opaque over inputs below */
}

/* Keep the search box visible when scrolling the menu */
.form-floating .choices__list--dropdown .choices__input{
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 1;
  border-bottom: 1px solid #e5e7eb;
}

/* Let menus escape their parents */
.form-floating { 
  position: relative; 
  overflow: visible !important; 
  z-index: 1;                   /* baseline below the opened one */
}

/* When a Choices field opens, lift THIS .form-floating above neighbors */
.form-floating:has(.choices.is-open),
.form-floating:has(.choices.is-focused) {
  z-index: 9999;                /* sits above the other dropdown titles */
}

/* Make sure the menu itself is on top */
.form-floating .choices {
  position: relative;
  z-index: 10000;               /* wrapper above siblings */
}
.form-floating .choices__list--dropdown,
.form-floating .choices__list[aria-expanded]{
  position: absolute;
  z-index: 11000;               /* menu above everything nearby */
  width: 100%;
  max-height: 260px;
  overflow: auto;
  background: #fff;
  box-shadow: 0 10px 24px rgba(0,0,0,.12);
}

/* If you use the mobile accordion, keep overflow open there too */
.filter-mobile,
.filter-mobile .accordion,
.filter-mobile .accordion-item,
.filter-mobile .accordion-body {
  overflow: visible !important;
}


  </style>
</head>
<body>

  <!-- ========= HERO ========= -->
  <section class="hero py-5">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="container position-relative" style="z-index:2">
      <div class="row align-items-center gy-4">
        <div class="col-lg-7">
          <span class="badge rounded-pill px-3 py-2 mb-3">Premium Listings • Verified Data</span>
          <h1 class="hero-title mb-3 text-white">Find the right property faster</h1>
          <p class="hero-sub mb-3">Search by building, community, city, or unit. Filter deeply and view clean, structured details.</p>
          <div class="hero-form-stats mt-3">
            <form method="GET" action="{{ url_for('home') }}" class="d-flex flex-column flex-sm-row gap-2">
              <input name="building" class="form-control hero-input" type="search" placeholder="Try “Dubai Marina”, a city, or a building name" value="{{ request.args.get('building','') }}">
              <button class="btn btn-light btn-cta text-primary" type="submit">Search</button>
            </form>
            <div class="hero-stats d-flex flex-wrap mt-3">
              <div class="hero-stat"><div class="num">{{ total_count if total_count is defined else '1,200+' }}</div><small>Active Listings</small></div>
              <div class="hero-stat"><div class="num">{{ total_communities if total_communities is defined else '80+' }}</div><small>Communities</small></div>
              <div class="hero-stat"><div class="num">{{ total_cities if total_cities is defined else '20+' }}</div><small>Cities</small></div>
            </div>
          </div>
        </div>
        <div class="col-lg-5 text-center">
          <img src="https://images.unsplash.com/photo-1526772662000-3f88f10405ff?q=80&w=1200&auto=format&fit=crop" alt="Dubai Skyline" class="img-fluid rounded-4 shadow-lg border border-white border-opacity-25">
          <div class="mt-3 text-white-75">
            <div class="fs-4 fw-bold">Coldwell Banker</div>
            <div>UAE Listings Hub</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ========= MAIN CONTENT ========= -->
  <div class="container py-5 section-bg">
    <h2 class="mb-4 text-center">Browse Listings</h2>

    <!-- Mobile Filter Accordion -->
    <div class="filter-mobile mb-4">
      <div class="accordion" id="filterAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">Filter & Sort</button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse">
            <div class="accordion-body">
              <form method="GET" class="row g-3">
                {% include "filter_form.html" %}
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Desktop Filters -->
    <form method="GET" class="row g-3 align-items-end mb-4 filter-desktop">
      {% include "filter_form.html" %}
    </form>

    <!-- Property Cards -->
    <div class="row">
      {% for prop in properties %}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="property-card h-100 p-3">

          <!-- Media with price & quick actions -->
          <div class="property-media mb-3">
            <img
              class="pc-img"
              src="{{ prop.hero_img }}"
              alt="{{ prop.building_name }}"
              loading="lazy"
              decoding="async"
              sizes="(max-width: 576px) 100vw, (max-width: 992px) 50vw, 33vw"
              srcset="{{ prop.hero_img }} 800w, {{ prop.hero_img }} 1200w"
              onload="this.classList.add('loaded')"
            >
            <div class="media-gradient"></div>

            <div class="quick-actions">
              <button class="qa-btn" title="Save" type="button" aria-label="Save">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#e03131" viewBox="0 0 16 16">
                  <path d="M8 2.748-.717 9.737l.717.737L8 4.414l8 6.06.717-.737L8 2.748z"/>
                </svg>
              </button>
              <a class="qa-btn" title="Open" aria-label="Open"
                 href="{{ url_for('property_detail', property_id=prop._id) }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0b2a66" viewBox="0 0 16 16">
                  <path d="M13 1a2 2 0 1 1-1.732 1H6.5a.5.5 0 0 0 0 1h4.768A2 2 0 1 1 13 1zM3 15a2 2 0 1 1 1.732-1H9.5a.5.5 0 0 0 0-1H4.732A2 2 0 1 1 3 15z"/>
                  <path d="M13 5a2 2 0 1 1-1.732 1H6.5a.5.5 0 0 0 0 1h4.768A2 2 0 1 1 13 5z"/>
                </svg>
              </a>
            </div>

            <div class="price-pill">
              {% if prop.price is number %} AED {{ "{:,.0f}".format(prop.price) }}
              {% else %} Price on request {% endif %}
            </div>
          </div>

          <!-- Body -->
          <div class="pc-body">
            <div class="pc-header">
              <span class="pc-dot"></span>
              <h5 class="pc-title">{{ prop.building_name }}</h5>
            </div>
            <div class="pc-sub">{{ prop.city or '' }}</div>

            <!-- Chips -->
            <div class="pc-chips">
              <span class="chip">{{ prop.beds if prop.beds is not none else 'N/A' }} Beds</span>
              <span class="chip">
                {% if prop.area_sqft is number %} {{ "{:,.0f}".format(prop.area_sqft) }} sqft
                {% else %} {{ prop.area_sqft or 'N/A' }} {% endif %}
              </span>
              <span class="chip muted">Unit {{ prop.unit_number }}</span>
            </div>

            <!-- Meta -->
            <div class="pc-meta">
              <div class="meta"><b>Type:</b> {{ prop.property_type or 'N/A' }}</div>
              <div class="meta"><b>Community:</b> {{ prop.community or 'N/A' }}</div>
            </div>

            <!-- Footer -->
            <div class="pc-footer">
              <a href="{{ url_for('property_detail', property_id=prop._id) }}"
                 class="btn btn-outline-primary btn-sm">View Details</a>
            </div>
          </div>

        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <nav class="mt-4">
      <ul class="pagination justify-content-center flex-wrap">
        {% set neighbors = 2 %}
        {% for p in range(1, total_pages + 1) %}
          {% if p == 1 or p == total_pages or (p >= current_page - neighbors and p <= current_page + neighbors) %}
            <li class="page-item {% if p == current_page %}active{% endif %}">
              <a class="page-link" href="{{ url_for('home') }}?{% for k,v in query_args.items() %}{{k}}={{ v|urlencode }}&{% endfor %}page={{ p }}">{{ p }}</a>
            </li>
          {% elif p == current_page - neighbors - 1 or p == current_page + neighbors + 1 %}
            <li class="page-item disabled"><span class="page-link">…</span></li>
          {% endif %}
        {% endfor %}
      </ul>
    </nav>
    {% endif %}
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Optional: smooth scroll to filters when clicking a hash -->
  <script>
    (function(){
      const hash = window.location.hash;
      if(hash === '#filters'){
        const el = document.querySelector('.filter-desktop') || document.querySelector('#filterAccordion');
        if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
      }
    })();
  </script>
</body>
</html>
